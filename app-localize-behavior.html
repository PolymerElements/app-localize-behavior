<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="app-localize-base.html">

<script>
  (function() {
    /**
     * `Polymer.AppLocalizeBehavior` wraps the [format.js](http://formatjs.io/) library to
     * help you internationalize your application. Note that if you're on a browser that
     * does not natively support the [Intl](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
     * object, you must load the polyfill yourself. An example polyfill can
     * be found [here](https://github.com/andyearnshaw/Intl.js/).
     *
     * `Polymer.AppLocalizeBehavior` supports the same [message-syntax](http://formatjs.io/guides/message-syntax/)
     * of format.js, in its entirety; use the library docs as reference for the
     * available message formats and options.
     *
     * Sample application loading resources from an external file:
     *
     *     <dom-module id="x-app">
     *        <template>
     *         <div>{{localize('hello', 'name', 'Batman')}}</div>
     *        </template>
     *        <script>
     *           Polymer({
     *             is: "x-app",
     *
     *             behaviors: [
     *               Polymer.AppLocalizeBehavior
     *             ],
     *
     *             properties: {
     *               language: {
     *                 value: 'en'
     *               },
     *             }
     *
     *             attached: function() {
     *               this.loadResources(this.resolveUrl('locales.json'));
     *             },
     *           });
     *        &lt;/script>
     *     </dom-module>
     *
     * Alternatively, you can also inline your resources inside the app itself:
     *
     *     <dom-module id="x-app">
     *        <template>
     *         <div>{{localize('hello', 'name', 'Batman')}}</div>
     *        </template>
     *        <script>
     *           Polymer({
     *             is: "x-app",
     *
     *             behaviors: [
     *               Polymer.AppLocalizeBehavior
     *             ],
     *
     *             properties: {
     *               language: {
     *                 value: 'en'
     *               },
     *               resources: {
     *                 value: function() {
     *                   return {
     *                     'en': { 'hello': 'My name is {name}.' },
     *                     'fr': { 'hello': 'Je m\'apelle {name}.' }
     *                   }
     *               }
     *             }
     *           });
     *        &lt;/script>
     *     </dom-module>
     *
     * @demo demo/index.html
     * @polymerBehavior Polymer.AppLocalizeBehavior
     */
    Polymer.AppLocalizeBehavior = {
      properties: {
        /**
         * The language used for translation.
         */
        language: String,

        /**
         * The dictionary of localized messages, for each of the languages that
         * are going to be used. See http://formatjs.io/guides/message-syntax/ for
         * more information on the message syntax.
         *
         * For example, a valid dictionary would be:
         * this.resources = {
         *  'en': { 'greeting': 'Hello!' }, 'fr' : { 'greeting': 'Bonjour!' }
         * }
         */
        resources: Object,

        /**
         * Optional dictionary of user defined formats, as explained here:
         * http://formatjs.io/guides/message-syntax/#custom-formats
         *
         * For example, a valid dictionary of formats would be:
         * this.formats = {
         *    number: { USD: { style: 'currency', currency: 'USD' } }
         * }
         */
        formats: {
          type: Object,
          value: function() { return {} }
        },

        /**
         * If true, will use the provided key when
         * the translation does not exist for that key.
         */
        useKeyIfMissing: {
          type: Boolean,
          value: false
        },

        /**
         * Translates a string to the current `language`. Any parameters to the
         * string should be passed in order, as follows:
         * `localize(stringKey, param1Name, param1Value, param2Name, param2Value)`
         */
        localize: {
          type: Function,
          computed: '__computeLocalize(language, resources, formats)'
        },

        /**
        * If true, will bubble up the event to the parents
        */
        bubbleEvent: {
          type: Boolean,
          value: false
        }
      },

      loadResources: Polymer.__appLocalizeBase.loadResources,
      __computeLocalize: Polymer.__appLocalizeBase.__computeLocalize,
      __onRequestResponse: Polymer.__appLocalizeBase.__onRequestResponse,
      __onRequestError: Polymer.__appLocalizeBase.__onRequestError,
    };
  })();
</script>
